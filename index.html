<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0"/>
<title>Sortify â€” Liked Songs Classifier</title>
<link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;700&family=Azeret+Mono:wght@400;500&display=swap" rel="stylesheet"/>
<link rel="stylesheet" href="style.css"/>
</head>
<body>

<header>
  <div>
    <div class="logo">SORTIFY<span>/</span>3</div>
  </div>
  <span class="version">MULTI-SOURCE</span>
  <div class="source-pills">
    <span class="spill spotify">Spotify</span>
    <span class="spill cyanite">Cyanite</span>
    <span class="spill lastfm">Last.fm</span>
  </div>
</header>

<div class="wrap">

  <!-- STEPS NAV -->
  <div class="steps-nav" id="steps-nav">
    <div class="step-dot active" data-step="0">01 Â· Keys</div>
    <div class="step-dot" data-step="1">02 Â· Playlists</div>
    <div class="step-dot" data-step="2">03 Â· Options</div>
    <div class="step-dot" data-step="3">04 Â· Processing</div>
    <div class="step-dot" data-step="4">05 Â· Done</div>
  </div>

  <!-- â•â•â• STEP 0: API KEYS â•â•â• -->
  <div id="step-0">
    <div class="instr">
      <strong>Setup â€” three services, all free for personal use:</strong><br/>
      <strong>1. Spotify</strong> â†’ <a href="https://developer.spotify.com/dashboard" target="_blank">developer.spotify.com/dashboard</a> â†’ Create app â†’ Add Redirect URI: <code id="redir-display">loading...</code> â†’ Enable Web API â†’ copy Client ID.<br/>
      <strong>2. Cyanite</strong> â†’ <a href="https://app.cyanite.ai" target="_blank">app.cyanite.ai</a> â†’ Create free account â†’ Settings â†’ Access Tokens â†’ Create token â†’ copy it. Gives BPM, key, mood, genre.<br/>
      <strong>3. Last.fm</strong> â†’ <a href="https://www.last.fm/api/account/create" target="_blank">last.fm/api/account/create</a> â†’ Create API account (free, instant) â†’ copy API key. Gives crowd-sourced tags.
    </div>

    <div class="card">
      <div class="card-title">Spotify <span class="src-tag src-spotify">via OAuth PKCE</span></div>
      <div class="field">
        <label>Client ID <span class="hint">From your Spotify app dashboard</span></label>
        <input type="text" id="sp-client-id" placeholder="e.g. 4a7b2c1d3e5f6a8b9c0d..."/>
      </div>
    </div>

    <div class="card">
      <div class="card-title">Cyanite <span class="src-tag src-cyanite">BPM Â· Key Â· Mood Â· Genre</span></div>
      <div class="field">
        <label>Access Token <span class="hint">From app.cyanite.ai â†’ Settings â†’ Access Tokens</span></label>
        <input type="password" id="cy-token" placeholder="Your Cyanite access token..."/>
      </div>
      <div class="instr-block">
        <strong>What Cyanite gives you:</strong> BPM, musical key, mood tags (energetic, dark, happy, calm, epicâ€¦), genre (pop, hiphop, rockâ€¦), energy level, valence. Analyzes tracks via their Spotify ID â€” no upload needed.
      </div>
    </div>

    <div class="card">
      <div class="card-title">Last.fm <span class="src-tag src-lastfm">Crowd Tags Â· Genre</span></div>
      <div class="field">
        <label>API Key <span class="hint">From last.fm/api/account/create â€” instant, no approval needed</span></label>
        <input type="text" id="lfm-key" placeholder="Your Last.fm API key..."/>
      </div>
      <div class="instr-block">
        <strong>What Last.fm adds:</strong> Crowd-sourced tags like "indie", "workout", "rainy day". Supplements Cyanite and fills gaps when a track hasn't been analyzed yet.
      </div>
    </div>

    <div class="btn-row">
      <button class="btn" id="btn-connect">Connect to Spotify â†’</button>
    </div>
  </div>

  <!-- â•â•â• STEP 1: PICK PLAYLISTS â•â•â• -->
  <div id="step-1" class="hidden">
    <div class="card">
      <div class="card-title">Target Playlists <span class="src-tag src-spotify">your playlists</span></div>
      <p style="font-size:0.75rem;color:var(--muted2);line-height:1.8;margin-bottom:1.2rem">
        Select which playlists liked songs should be sorted into. Each playlist is fingerprinted
        using Cyanite analysis of its existing tracks to build an audio centroid (average BPM, mood, genre profile).
        Liked songs are matched to the nearest centroid, boosted by playlist name keywords.
      </p>
      <div class="pick-bar">
        <button class="btn btn-secondary btn-sm" id="btn-all">All</button>
        <button class="btn btn-secondary btn-sm" id="btn-none">None</button>
        <span id="pick-count" class="mono">0 selected</span>
      </div>
      <div class="pl-grid" id="pl-grid">
        <div class="skel"></div><div class="skel"></div><div class="skel"></div>
      </div>
    </div>
    <div class="btn-row">
      <button class="btn" id="btn-to-opts" disabled>Configure Options â†’</button>
      <button class="btn btn-secondary" id="btn-back-0">â† Back</button>
    </div>
  </div>

  <!-- â•â•â• STEP 2: OPTIONS â•â•â• -->
  <div id="step-2" class="hidden">
    <div class="card">
      <div class="card-title">Matching Options <span class="src-tag src-all">classification tuning</span></div>

      <div class="field">
        <label>Confidence Threshold <span class="hint">How strict the match must be</span></label>
        <div class="slider-wrap">
          <span class="slider-label">Strict</span>
          <input type="range" id="thresh" min="0.1" max="1.0" step="0.05" value="0.6"/>
          <span class="slider-label">Loose</span>
          <span class="slider-val" id="thresh-val">0.60</span>
        </div>
        <div class="slider-desc">Songs too different from all your playlists are skipped. Lower = fewer but more accurate matches. Recommended: 0.55â€“0.70</div>
      </div>

      <div class="field">
        <label>Cyanite Sample Rate <span class="hint">Tracks per playlist analyzed for fingerprinting</span></label>
        <div class="slider-wrap">
          <span class="slider-label">10</span>
          <input type="range" id="sample-rate" min="10" max="100" step="5" value="30"/>
          <span class="slider-label">100</span>
          <span class="slider-val" id="sample-val">30</span>
        </div>
        <div class="slider-desc">More samples = better fingerprint but more API calls. 30 is a good balance for Cyanite's free tier rate limits.</div>
      </div>

      <div class="sep"></div>

      <label class="toggle-row">
        <input type="checkbox" id="opt-keywords" checked/>
        <span>ğŸ”¤ Playlist name keyword boosting â€” nudges ambiguous matches toward semantically aligned playlists</span>
      </label>
      <label class="toggle-row">
        <input type="checkbox" id="opt-lastfm" checked/>
        <span>ğŸ”´ Use Last.fm tags to supplement Cyanite â€” fills gaps for unanalyzed tracks</span>
      </label>
      <label class="toggle-row">
        <input type="checkbox" id="opt-dupes" checked/>
        <span>ğŸ” Skip songs already in target playlist (de-duplication)</span>
      </label>
    </div>

    <div class="btn-row">
      <button class="btn" id="btn-run">Analyse & Sort â†’</button>
      <button class="btn btn-secondary" id="btn-back-1">â† Back</button>
    </div>
  </div>

  <!-- â•â•â• STEP 3: PROCESSING â•â•â• -->
  <div id="step-3" class="hidden">
    <div class="progress-card">
      <div style="font-size:0.65rem;font-family:'Azeret Mono',monospace;letter-spacing:2px;text-transform:uppercase;color:var(--muted2);margin-bottom:0.5rem">Processing</div>
      <div class="prog-bar-bg"><div class="prog-bar-fill" id="prog-fill"></div></div>
      <div class="prog-label" id="prog-label">Initializing...</div>
    </div>
    <div class="log" id="log"></div>
  </div>

  <!-- â•â•â• STEP 4: RESULTS â•â•â• -->
  <div id="step-4" class="hidden">
    <div class="stat-row" id="stat-row"></div>
    <div class="results-list" id="results-list"></div>
    <div id="skipped-notice"></div>
    <div class="btn-row">
      <button class="btn btn-secondary" id="btn-restart">â† Start Over</button>
    </div>
  </div>

</div><!-- /wrap -->

<script src="app.js"></script>
</body>
</html>
